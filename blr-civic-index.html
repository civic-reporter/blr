<!DOCTYPE html>
<html data-theme="light" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Civic Reporter - Bengaluru</title>

  <!-- Modern fonts + icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- Local libs -->
  <link rel="stylesheet" href="assets/css/leaflet.css" />
  <link rel="stylesheet" href="assets/css/styles.css" />

  <script src="assets/js/piexif.min.js"></script>
  <script src="assets/js/leaflet.js"></script>

  <!-- Google Maps Places API -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyACm02bNVbJsIZrSZCtWNVBn_1iT5Thtn0&libraries=places"></script>
</head>

<body>
  <!-- Navigation Header -->
  <header class="page-header">
    <div class="nav-left">
      <a href="index.html" class="nav-home" data-i18n-title="backToHome">
        <i class="fas fa-home"></i>
        <span data-i18n="homeTitle">Zen Citizen</span>
      </a>
    </div>
    <div class="nav-right">
      <a id="switchPageBtn" href="blr-traffic-index.html" class="nav-switch-btn" data-i18n-title="switchToTraffic">
        <i class="fas fa-exchange-alt"></i>
        <span id="switchLabel" data-i18n="switchToTraffic">Report Traffic</span>
      </a>
    </div>
  </header>

  <!-- Floating theme toggle -->
  <button id="themeToggle" class="theme-toggle-btn" data-i18n-aria="toggleTheme" title="Toggle light/dark mode">
    <i class="fas fa-sun"></i>
    <i class="fas fa-moon" style="display:none;"></i>
  </button>

  <div class="container">
    <h2 data-i18n="civicReporterTitle">ğŸ›ï¸ Civic Reporter - Bengaluru</h2>
    <p class="header-text" data-i18n="civicReporterDesc">Report potholes, drainage, streetlights to Greater Bengaluru
      Authority</p>

    <!-- Image Upload Options (visible when no image loaded) -->
    <div id="uploadOptions" class="upload-options">
      <p class="header-text" data-i18n="uploadInstructions">Click (mobile only) or upload a photo (GPS is
        auto-detected). If GPS is missing, choose the
        location on the map.</p>
      <div class="button-group">
        <!-- Camera button (mobile only) -->
        <button id="cameraBtn" class="upload-btn camera-btn">
          ğŸ“· <span data-i18n="mobileCamera">Mobile Camera</span>
        </button>
        <!-- File upload button -->
        <button id="uploadBtn" class="upload-btn">
          â¬†ï¸ <span data-i18n="uploadPhoto">Upload Photo</span>
        </button>
      </div>
      <!-- Hidden real inputs (file, image-only) -->
      <input type="file" id="imageInput" style="display:none" />
      <input type="file" id="cameraInput" capture="environment" style="display:none" />
    </div>

    <!-- Image Preview -->
    <img id="preview" style="display:none;" />

    <!-- Image confirmation -->
    <div id="imageConfirm" style="display:none;" class="image-confirm">
      <p data-i18n="isPhotoCorrect">Is this photo correct?</p>
      <button id="changeImageBtn" class="upload-btn">
        ğŸ” <span data-i18n="chooseAnotherPhoto">Choose another photo</span>
      </button>
      <label class="confirm-check">
        <input type="checkbox" id="confirmImageCheck" />
        <span data-i18n="confirmPhotoText">I confirm this photo clearly shows the issue.</span>
      </label>
    </div>

    <!-- Map -->
    <div id="map"></div>

    <!-- Location Info & Form -->
    <div id="locationInfo" style="display:none">
      <div class="info-box" id="infoBox">
        <div><strong data-i18n="locationLabel">ğŸ“ Location:</strong> <span id="gpsCoords"></span></div>
        <div id="mapRestrictionMsg" class="map-message" style="display:none" data-i18n="mapRestrictionMsg">
          âš ï¸ Map clicks outside GBA jurisdiction are automatically rejected.
        </div>
        <div class="issue-row">
          <select id="issueType"
            data-i18n-options="pothole,footpath,drainageIssue,streetlight,garbage,manhole,roadRepair,other">
            <option value="Pothole" data-i18n="pothole">Pothole</option>
            <option value="Footpath" data-i18n="footpath">Footpath</option>
            <option value="Drainage" data-i18n="drainageIssue">Drainage issue</option>
            <option value="Streetlight" data-i18n="streetlight">Streetlight</option>
            <option value="Garbage" data-i18n="garbage">Garbage</option>
            <option value="Manhole" data-i18n="manhole">Manhole</option>
            <option value="Road" data-i18n="roadRepair">Road repair</option>
            <option value="Other" data-i18n="other">Other</option>
          </select>
          <input id="issueDesc" data-i18n-placeholder="issueDetails" placeholder="Extra details (optional)"
            maxlength="120" />
        </div>
        <div><strong data-i18n="tweetFrom">ğ• Tweet from:</strong>
          <span class="gba-handle">@zenc_civic</span>
        </div>
        <small data-i18n="dragMarkerInstruction">ğŸ”§ Drag marker or click map to adjust location <strong>(within GBA area
            only)</strong>.</small>
      </div>

      <button id="tweetBtn" disabled data-i18n="postIssue">
        ğŸš¨ Post Issue via @zenc_civic
      </button>
    </div>

    <!-- Status Messages -->
    <div id="status"></div>

    <!-- Success Screen (Submit Another Issue) -->
    <div id="successScreen" style="display:none; text-align:center; padding: 2rem;">
      <div class="success-icon">âœ…</div>
      <h3>Issue Posted Successfully!</h3>
      <p>Your report has been tweeted to GBA via @zenc_civic</p>

      <!-- Tweet URL + copy button stay here, within the container -->
      <div id="tweetLinkContainer"></div>

      <button id="submitAnotherBtn" class="upload-btn">
        ğŸ“¸ Submit Another Issue
      </button>
    </div>

    <!-- Inline copyright inside the container -->
    <div class="app-footer">
      <small>Â© Zen Citizen Â· <a id="privacyLink" href="privacy.html"
          style="text-decoration: none; color: var(--x-text-secondary);"><span data-i18n="privacyLink">Privacy
            Policy</span></a></small>
    </div>
  </div>

  <!-- Load the app -->
  <script>
    const html = document.documentElement;

    function initTheme() {
      const saved = localStorage.getItem("theme");
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const initial = saved || (prefersDark ? "dark" : "light");
      html.setAttribute("data-theme", initial);
      updateThemeToggle(initial);
    }

    function updateThemeToggle(theme) {
      const sun = document.querySelector('#themeToggle .fa-sun');
      const moon = document.querySelector('#themeToggle .fa-moon');
      if (theme === 'dark') {
        sun.style.display = 'none';
        moon.style.display = 'block';
      } else {
        sun.style.display = 'block';
        moon.style.display = 'none';
      }
    }

    // Initialize
    initTheme();

    window.addEventListener("DOMContentLoaded", () => {
      // Initialize language switcher
      import('./assets/js/language-switcher.js').then(({ initLanguageSwitcher }) => {
        initLanguageSwitcher();
      });

      const btn = document.getElementById("themeToggle");
      if (!btn) return;

      btn.addEventListener("click", () => {
        const current = html.getAttribute("data-theme") || "light";
        const next = current === "light" ? "dark" : "light";
        html.setAttribute("data-theme", next);
        localStorage.setItem("theme", next);
        updateThemeToggle(next);
      });
    });
  </script>

  <script type="module" src="assets/web/app.js"></script>

  <!-- Navigation setup -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const switchBtn = document.getElementById('switchPageBtn');
      if (switchBtn) {
        switchBtn.href = 'blr-traffic-index.html';
        switchBtn.title = 'Switch to Traffic Reporter';
      }
    });
  </script>

</body>

</html>