<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GBA Civic Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .chat-container{width:100%;max-width:500px;height:700px;background:#fff;border-radius:24px;box-shadow:0 32px 80px rgba(0,0,0,.3);display:flex;flex-direction:column;overflow:hidden}
    .chat-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:24px;text-align:center}
    .chat-header h1{font-size:20px;margin-bottom:4px}
    .chat-header p{font-size:14px;opacity:.9}
    .chat-messages{flex:1;padding:24px;overflow-y:auto;background:#f8f9fa}
    .message{margin-bottom:16px;display:flex;gap:10px}
    .message.user{justify-content:flex-end}
    .message.bot{justify-content:flex-start}
    .avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;color:#fff;flex-shrink:0}
    .avatar.bot{background:linear-gradient(135deg,#667eea,#764ba2)}
    .avatar.user{background:#28a745}
    .bubble{max-width:75%;padding:12px 16px;border-radius:18px;line-height:1.4;box-shadow:0 2px 8px rgba(0,0,0,.1);font-size:14px}
    .message.user .bubble{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-bottom-right-radius:6px}
    .message.bot .bubble{background:#fff;color:#333;border-radius:18px}
    .chat-input{padding:16px 18px;border-top:1px solid #e9ecef;display:flex;gap:10px;align-items:center;background:#fff}
    .chat-input input{flex:1;border:2px solid #e9ecef;border-radius:20px;padding:10px 14px;font-size:14px;outline:none}
    .chat-input input:focus{border-color:#667eea}
    .chat-input button{border:none;background:#667eea;color:#fff;border-radius:20px;padding:10px 18px;font-size:14px;cursor:pointer;white-space:nowrap}
    .chat-input button:disabled{opacity:.6;cursor:not-allowed}
    @media(max-width:480px){.chat-container{height:100vh;border-radius:0}body{padding:0}}
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <h1>üèõÔ∏è GBA Civic Bot</h1>
      <p>Report potholes & civic issues via chat</p>
    </div>
    <div id="messages" class="chat-messages"></div>
    <div class="chat-input">
      <input id="input" type="text" placeholder="Describe the issue or ask what to do..." />
      <button id="sendBtn">Send</button>
    </div>
  </div>

  <script>
    const API_URL = "https://0gn84wckhl.execute-api.ap-south-1.amazonaws.com/chat";

    const messagesEl = document.getElementById("messages");
    const inputEl = document.getElementById("input");
    const sendBtn = document.getElementById("sendBtn");

    const messages = [
      { role: "bot", text: "Hi! I am GBA Civic Bot. Tell me about a pothole, drainage, garbage or road issue and I will guide you step‚Äëby‚Äëstep to file it via @zenc_civic." }
    ];

    function renderMessages() {
      messagesEl.innerHTML = "";
      for (const m of messages) {
        const row = document.createElement("div");
        row.className = "message " + (m.role === "user" ? "user" : "bot");

        const avatar = document.createElement("div");
        avatar.className = "avatar " + (m.role === "user" ? "user" : "bot");
        avatar.textContent = m.role === "user" ? "üë§" : "üèõÔ∏è";

        const bubble = document.createElement("div");
        bubble.className = "bubble";
        bubble.textContent = m.text;

        row.appendChild(m.role === "user" ? bubble : avatar);
        row.appendChild(m.role === "user" ? avatar : bubble);
        messagesEl.appendChild(row);
      }
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;

      messages.push({ role: "user", text });
      inputEl.value = "";
      renderMessages();

      sendBtn.disabled = true;
      try {
        const url = API_URL + "?prompt=" + encodeURIComponent(text);
        const res = await fetch(url);
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        messages.push({ role: "bot", text: data.reply || "Sorry, I could not understand that." });
      } catch (e) {
        console.error(e);
        messages.push({ role: "bot", text: "Sorry, the civic chat service is unavailable. Please try again later." });
      } finally {
        sendBtn.disabled = false;
        renderMessages();
        inputEl.focus();
      }
    }

    sendBtn.addEventListener("click", sendMessage);
    inputEl.addEventListener("keydown", e => {
      if (e.key === "Enter") sendMessage();
    });

    renderMessages();
    inputEl.focus();
  </script>
</body>
</html>
