<!DOCTYPE html>
<html data-theme="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ğŸš¦ Traffic Reporter â€“ @BlrCityPolice</title>

    <!-- Modern fonts + icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- SAME CSS/JS as civic -->
    <link rel="stylesheet" href="assets/css/leaflet.css" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <script src="assets/js/piexif.min.js"></script>
    <script src="assets/js/leaflet.js"></script>

    <!-- Google Maps Places API -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyACm02bNVbJsIZrSZCtWNVBn_1iT5Thtn0&libraries=places&loading=async"></script>

    <!-- Face detection for privacy protection - load synchronously before modules -->
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api@latest/dist/face-api.min.js"></script>
</head>

<body>
    <!-- Navigation Header -->
    <header class="page-header">
        <div class="nav-left">
            <a href="index.html" class="nav-home" data-i18n-title="backToHome">
                <i class="fas fa-home"></i>
                <span data-i18n="homeTitle">Zen Citizen</span>
            </a>
        </div>
        <div class="nav-right">
            <a id="switchPageBtn" href="blr-civic-index.html" class="nav-switch-btn" data-i18n-title="switchToCivic">
                <i class="fas fa-exchange-alt"></i>
                <span id="switchLabel" data-i18n="switchToCivic">Report Civic Issue</span>
            </a>
        </div>
    </header>

    <!-- Floating theme toggle -->
    <button id="themeToggle" class="theme-toggle-btn" data-i18n-aria="toggleTheme" title="Toggle light/dark mode">
        <i class="fas fa-sun"></i>
        <i class="fas fa-moon" style="display:none;"></i>
    </button>

    <div class="container">
        <h2 data-i18n="trafficReporterTitle">ğŸš¦ Traffic Reporter â€“ Bengaluru</h2>
        <p class="header-text" data-i18n="trafficReporterDesc">Report traffic signals, jams, parking to Bengaluru
            Traffic Authorities</p>

        <!-- Image Upload Options -->
        <div id="uploadOptions" class="upload-options">
            <p class="header-text" data-i18n="uploadInstructions">Click (mobile only) or upload a photo (GPS is
                auto-detected). If GPS is missing,
                choose the location on the map.</p>
            <div class="button-group">
                <button id="cameraBtn" class="upload-btn camera-btn">
                    ğŸ“· <span data-i18n="mobileCamera">Mobile Camera</span>
                </button>
                <button id="uploadBtn" class="upload-btn">
                    â¬†ï¸ <span data-i18n="uploadPhoto">Upload Photo</span>
                </button>
            </div>
            <!-- Hidden inputs -->
            <input type="file" id="imageInput" style="display:none" accept="image/*" />
            <input type="file" id="cameraInput" capture="environment" style="display:none" accept="image/*" />
        </div>

        <!-- Image Preview -->
        <img id="preview" style="display:none;" alt="Traffic issue photo" />

        <!-- Image confirmation -->
        <div id="imageConfirm" style="display:none;" class="image-confirm">
            <p data-i18n="photoCorrectTraffic">Photo correct for traffic report?</p>
            <button id="changeImageBtn" class="upload-btn">
                ğŸ” <span data-i18n="chooseAnotherPhoto">Choose another photo</span>
            </button>
            <label class="confirm-check">
                <input type="checkbox" id="confirmImageCheck" />
                <span data-i18n="confirmPhotoTraffic">I confirm photo shows traffic issue clearly.</span>
            </label>
        </div>

        <!-- Map -->
        <div id="map"></div>

        <!-- Traffic Form -->
        <div id="locationInfo" style="display:none;">
            <div class="info-box traffic-info" id="infoBox">
                <div><strong data-i18n="locationLabel">ğŸ“ Location:</strong> <span id="gpsCoords"></span></div>
                <div id="mapRestrictionMsg" class="map-message" style="display:none" data-i18n="trafficStayInLimits">
                    âš ï¸ Stay within Bengaluru limits
                </div>
                <div class="issue-row">
                    <select id="trafficCategory" required
                        data-i18n-options="selectTrafficIssue,signalDown,trafficJam,wrongParking,speedBreaker,diversion,otherTraffic">
                        <option value="" data-i18n="selectTrafficIssue">Select traffic issue...</option>
                        <option value="signal-down" data-i18n="signalDown">ğŸš¦ Traffic Signal Down</option>
                        <option value="traffic-jam" data-i18n="trafficJam">ğŸš— Traffic Jam</option>
                        <option value="wrong-parking" data-i18n="wrongParking">ğŸš—â€ Wrong Parking</option>
                        <option value="speed-breaker" data-i18n="speedBreaker">ğŸš§ Missing Speed Breaker</option>
                        <option value="diversion" data-i18n="diversion">ğŸ›£ï¸ Diversion Needed</option>
                        <option value="other" data-i18n="otherTraffic">Other traffic issue</option>
                    </select>
                    <input id="trafficDesc" data-i18n-placeholder="locationDetails"
                        placeholder="Location details, road name (optional)" maxlength="120" />
                </div>
                <div><strong data-i18n="tweetFrom">ğ• Tweet from:</strong>
                    <span class="traffic-handle">@zenc_civic</span>
                </div>
                <small data-i18n="dragMarkerTraffic">ğŸ”§ Drag marker or click map to set exact location.</small>
            </div>

            <button id="trafficSubmit" class="upload-btn" disabled data-i18n="reportTraffic">
                ğŸš¦ Report Traffic to @BlrCityPolice
            </button>
        </div>

        <!-- Status Messages -->
        <div id="status"></div>

        <!-- Success Screen -->
        <div id="successScreen" style="display:none; text-align:center; padding: 2rem;">
            <div class="success-icon">âœ…</div>
            <h3>Traffic Issue Reported!</h3>
            <p>Your report tweeted to @BlrCityPolice</p>
            <div id="tweetLinkContainer"></div>
            <button id="submitAnotherBtn" class="upload-btn">
                ğŸš¦ Report Another Traffic Issue
            </button>
        </div>

        <!-- Footer -->
        <div class="app-footer">
            <small>Â© Zen Citizen Â· <a id="privacyLink" href="privacy.html"
                    style="text-decoration: none; color: var(--x-text-secondary);"><span data-i18n="privacyLink">Privacy
                        Policy</span></a></small>
        </div>
    </div>

    <!-- SAME THEME SCRIPT as civic -->
    <script>
        const html = document.documentElement;

        function initTheme() {
            const saved = localStorage.getItem("theme");
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const initial = saved || (prefersDark ? "dark" : "light");
            html.setAttribute("data-theme", initial);
            updateThemeToggle(initial);
        }

        function updateThemeToggle(theme) {
            const sun = document.querySelector('#themeToggle .fa-sun');
            const moon = document.querySelector('#themeToggle .fa-moon');
            if (theme === 'dark') {
                sun.style.display = 'none';
                moon.style.display = 'block';
            } else {
                sun.style.display = 'block';
                moon.style.display = 'none';
            }
        }

        // Initialize
        initTheme();

        window.addEventListener("DOMContentLoaded", () => {
            // Initialize language switcher
            import('./assets/js/language-switcher.js').then(({ initLanguageSwitcher }) => {
                initLanguageSwitcher();
            });

            const btn = document.getElementById("themeToggle");
            if (!btn) return;

            btn.addEventListener("click", () => {
                const current = html.getAttribute("data-theme") || "light";
                const next = current === "light" ? "dark" : "light";
                html.setAttribute("data-theme", next);
                localStorage.setItem("theme", next);
                updateThemeToggle(next);
            });
        });
    </script>

    <!-- TRAFFIC APP -->
    <script type="module" src="assets/web/traffic-app.js"></script>

    <!-- Navigation setup -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const switchBtn = document.getElementById('switchPageBtn');
            if (switchBtn) {
                switchBtn.href = 'blr-civic-index.html';
                switchBtn.title = 'Switch to Civic Reporter';
            }
        });
    </script>
</body>

</html>