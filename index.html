<!DOCTYPE html>
<html data-theme="light" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GBA Civic Reporter â€“ Greater Bengaluru Authority</title>

  <!-- Local libs -->
  <link rel="stylesheet" href="assets/css/leaflet.css" />
  <link rel="stylesheet" href="assets/css/styles.css" />

  <script src="assets/js/piexif.min.js"></script>
  <script src="assets/js/leaflet.js"></script>

  <link rel="stylesheet" href="assets/css/Control.Geocoder.css" />
  <script src="assets/js/Control.Geocoder.js"></script>
</head>

<body>
  <button id="themeToggle" type="button" class="theme-toggle-btn">
    â˜€ï¸ / ğŸŒ™
  </button>

  <div class="container">
    <h2>ğŸ›ï¸ GBA Civic Reporter â€“ Greater Bengaluru Authority</h2>


    <!-- Image Upload Options (visible when no image loaded) -->
    <div id="uploadOptions" class="upload-options">
      <p class="header-text">Click (mobile only) or upload a photo (GPS is auto-detected). If GPS is missing, choose the
        location on
        the
        map.</p>
      <div class="button-group">
        <!-- Camera button (mobile only) -->
        <button id="cameraBtn" class="upload-btn camera-btn">
          ğŸ“· <span>Mobile Camera</span>
        </button>
        <!-- File upload button -->
        <button id="uploadBtn" class="upload-btn">
          â¬†ï¸ <span>Upload Photo</span>
        </button>
      </div>
      <!-- Hidden real inputs (file, image-only) -->
      <input type="file" id="imageInput" style="display:none" />
      <input type="file" id="cameraInput" capture="environment" style="display:none" />
    </div>

    <!-- Image Preview -->
    <img id="preview" style="display:none;" />

    <!-- Image confirmation -->
    <div id="imageConfirm" style="display:none;" class="image-confirm">
      <p>Is this photo correct?</p>
      <button id="changeImageBtn" class="upload-btn">
        ğŸ” Choose another photo
      </button>
      <label class="confirm-check">
        <input type="checkbox" id="confirmImageCheck" />
        <span>I confirm this photo clearly shows the issue.</span>
      </label>
    </div>

    <!-- Map -->
    <div id="map"></div>

    <!-- Location Info & Form -->
    <div id="locationInfo" style="display:none">
      <div class="info-box" id="infoBox">
        <div><strong>ğŸ“ Location:</strong> <span id="gpsCoords"></span></div>
        <div id="mapRestrictionMsg" class="map-message" style="display:none">
          âš ï¸ Map clicks outside GBA jurisdiction are automatically rejected.
        </div>
        <div class="issue-row">
          <select id="issueType">
            <option value="Pothole">Pothole</option>
            <option value="Footpath">Footpath</option>
            <option value="Drainage">Drainage issue</option>
            <option value="Streetlight">Streetlight</option>
            <option value="Garbage">Garbage</option>
            <option value="Manhole">Manhole</option>
            <option value="Road">Road repair</option>
            <option value="Other">Other</option>
          </select>
          <input id="issueDesc" placeholder="Extra details (optional), please ref" maxlength="120" />
        </div>
        <div><strong>ğ• Tweet from:</strong>
          <span class="gba-handle">@zenc_civic</span>
        </div>
        <small>ğŸ”§ Drag marker or click map to adjust location <strong>(within GBA area only)</strong>.</small>
      </div>

      <button id="tweetBtn" disabled>
        ğŸš¨ Post Issue via @zenc_civic
      </button>
    </div>

    <!-- Status Messages -->
    <div id="status"></div>

    <!-- Success Screen (Submit Another Issue) -->
    <div id="successScreen" style="display:none; text-align:center; padding: 2rem;">
      <div class="success-icon">âœ…</div>
      <h3>Issue Posted Successfully!</h3>
      <p>Your report has been tweeted to GBA via @zenc_civic</p>

      <!-- Tweet URL + copy button stay here, within the container -->
      <div id="tweetLinkContainer"></div>

      <button id="submitAnotherBtn" class="upload-btn">
        ğŸ“¸ Submit Another Issue
      </button>
    </div>

    <!-- Inline copyright inside the container -->
    <div class="app-footer">
      <small>Â© Zen Citizen</small>
    </div>
  </div>

  <!-- Load the app -->
  <script>
    const html = document.documentElement;

    // On load: use saved theme or default to light
    (function initTheme() {
      const saved = localStorage.getItem("theme");
      const initial = saved || "light";
      html.setAttribute("data-theme", initial);
    })();

    window.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("themeToggle");
      if (!btn) return;

      btn.addEventListener("click", () => {
        const current = html.getAttribute("data-theme") || "light";
        const next = current === "light" ? "dark" : "light";
        html.setAttribute("data-theme", next);
        localStorage.setItem("theme", next);
      });
    });
  </script>

  <script src="assets/web/app.js"></script>
</body>

</html>